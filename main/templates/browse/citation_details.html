{% extends "browse/base.html" %}

{% load relaton %}

{% block title %}
  {{ block.super }}
  —
  {% with docid=data.docid|as_list|first %}
    {{ docid.type }}/{{ docid.id }}
    —
  {% endwith %}
  {% include "relaton/first_title.html" with title=data.title %}
{% endblock %}


{% block content %}
  <header class="">
    {% include "relaton/doc_ids.html" with ids=data.docid|as_list %}
    <h2 class="fw3 f3 measure-wide">
      {% include "relaton/first_title.html" with title=data.title %}
    </h2>
  </header>

  <div class="cf">
    <div class="fl w-100 w-50-ns">
      <dl class="lh-title pv2 mt0">
        {% include "deflist/entry.html" with key="edition" val=data.edition|default:"—" %}
        {% if data.date %}
          {% for date in data.date|as_list %}
            {% include "deflist/entry.html" with key=date.type val=date.value %}
          {% endfor %}
        {% endif %}
        {% include "deflist/entry.html" with key="revdate" val=data.revdate|default:"—" %}
        {% include "deflist/entry.html" with key="fetched" val=data.fetched|default:"—" %}
        {% for c in data.contributor|as_list %}
          {% if c.organization %}
            {% include "deflist/entry_recursivedict.html" with key=c.role|default:"contributor"|as_list|join:", " val=c.organization %}
          {% elif c.person.name %}
            {% include "deflist/entry.html" with key=c.role|default:"contributor"|as_list|join:", " val=c.person.name tmpl="relaton/person_name.html" %}
          {% else %}
            {% include "deflist/entry_recursivedict.html" with key=c.role|default:"contributor"|as_list|join:", " val=c %}
          {% endif %}
        {% endfor %}
        {% include "deflist/entry_list.html" with key="place(s)" items=data.place|default:"—"|as_list %}
      </dl>
    </div>

    <div class="fl w-100 w-50-ns">
      <dl class="lh-title pv2 mt0">
        {% for relation in data.relation|as_list %}
          {% include "deflist/entry.html" with key=relation.description.content|default:relation.type|default:"relates to" val=relation.bibitem.formattedref.content tmpl="citation/docid_link.html" %}
        {% endfor %}
        {% include "deflist/entry.html" with key="type" val=data.type %}
        {% include "deflist/entry.html" with key="language" val=data.language|default:"—"|as_list|join:', ' %}
        {% for link in data.link|as_list %}
          {% include "deflist/entry.html" with key=link.type|default:"link" val=link.content %}
        {% endfor %}
        {% for title in data.title|as_list %}
          {% include "deflist/entry.html" with key=title.type|default:""|stringformat:"s (title)" val=title.content %}
        {% endfor %}
        {% include "deflist/entry_list.html" with key="abstract(s)" items=data.abstract|default:"—"|as_list tmpl="relaton/formatted_string.html" multiline=1 %}
      </dl>
    </div>
  </div>

  {% include "citation/download_links.html" with docid=data.docid|as_list|first %}

  <div class="gray f7">
    <p class="gray f7">
      Available using API:
    </p>
    <ul class="list">
      {% for docid in data.docid|as_list %}
        <li>{% url "api_get_by_docid" %}?doctype={{ docid.type }}&docid={{ docid.id|urlencode:"" }}
      {% endfor %}
    </ul>
  </div>

  <dl class="lh-title pv2 mt2">
    {% if data.copyright %}
      {% include "deflist/entry_list.html" with key="copyright(s)" items=data.copyright|as_list tmpl="deflist/entry_recursivedict.html" %}
    {% endif %}
    {% if data.keyword %}
      {% include "deflist/entry_list.html" with key="keywords" items=data.keyword|as_list %}
    {% endif %}
  </dl>

  {% if data.sources %}
    <dl class="lh-title mt0">
      {% for source in data.sources.items %}
        <dt class="b nowrap mt1 f6">
          source “{{ source.0 }}”:
        </dt>
        <dd class="ml0">
          {% if source.1.ref %}
            ref. {{ source.1.ref }}
          {% endif %}
          {% if not source.1.ref or source.1.validation_errors %}
            {% if source.1.validation_errors %}
              <span class="dark-red f6">(source structure warnings)</span>
            {% endif %}
            <pre class="code pre gray f7 h4 overflow-y-auto">{{ source.1.validation_errors|default:"(no validation errors)" }}<br /><br />{{ source.1.bibitem | pprint }}</pre>
          {% endif %}
        </dd>
      {% endfor %}
    </dl>
  {% endif %}
{% endblock %}
